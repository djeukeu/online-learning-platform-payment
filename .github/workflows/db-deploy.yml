name: Database Deployment Ci
run-name: ${{ github.actor }} triggered the Database Deployment Ci

on:
    push:
        branches:
            - 'develop'
        paths:
            - 'prisma/**'

jobs:
    deploy:
        runs-on: ubuntu-24.04
        env:
            DATABASE_URL: ${{ secrets.DATABASE_URL }}
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0
            - name: Read node version
              id: nvmrc
              uses: browniebroke/read-nvmrc-action@v1
            - name: Setup Nodejs
              uses: actions/setup-node@v4
              with:
                  node-version: '${{ steps.nvmrc.outputs.node_version }}'
            - name: Prisma Deploy
              run: |
                  yarn 
                  yarn prisma:deploy
            - name: Cache node modules
              uses: actions/cache@v4
              with:
                  path: node_modules
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package.json') }}
                  restore-keys: |
                      ${{ runner.os }}-node-
